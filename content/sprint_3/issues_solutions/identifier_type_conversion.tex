%!TEX root = ../../../super_main.tex
\section{Identifier Type Conversion} % (fold)
\label{sec:identifier_type_conversion}

% section identifier_type_conversion (end)

Most Android classes that work with database identifiers (IDs) expects the IDs to be of type \androidinline{long}. When we started with this project all IDs from the database abstraction classes were of type \androidinline{int}, which caused a lot of unnecessary casts, and made it more difficult to implement \androidinline{Adapter} subclasses and use other Android Framework elements.\\

We therefore decided along with the database groups to convert all use of IDs from \androidinline{int} to \androidinline{long} across all code. The conversion meant that we had to change code across all subproject applications and libraries. This conversion, however, did not go as smoothly as planned, and suddenly nothing worked as it was supposed to, because none of database IDs that are sent between the \giraf suite's applications matched their expected type. \\

\subsection{Problem}
The database groups started out changing all database abstraction classes' \androidinline{getId} methods to return IDs of type \androidinline{long}. We then expected the type system to give error messages everywhere the new \androidinline{getId} methods are used. It turned out that we had placed too much trust in the type system. The different \androidinline{Activity} classes across the \giraf suite communicate with each other using instances of the \androidinline{Intent} class as mentioned in \secref{sec:using_pictosearch}. This communication happens both internally and externally between the different applications in the \giraf suite. Data is parsed between the different \androidinline{Activity} classes using a \androidinline{Bundle} object, called ``Extra'', which is maintained by an \androidinline{Intent} instance. \\

The problem was then, that a method \androidinline{putExtra} on the \androidinline{Intent} class is overloaded multiple times to handle all the built-in primitive types in Java. All calls to \androidinline{putExtra} were using the overloaded method which puts a \androidinline{long}, instead of \androidinline{int} as previously, into the internal \androidinline{Bundle} of the \androidinline{Intent}. This caused the \androidinline{Bundle} instances in the different \androidinline{Intent} instances to include key-value pairs where the values were of type \androidinline{long} only the code explicitly asked for a value of type \androidinline{int}, using the method \androidinline{getInt}, everywhere the value of one of these key-value pairs were attempted retrieved. The result was then that the \androidinline{Bundle} instances could not find any \androidinline{int} values matching the requested key and therefore returned the default value of the \androidinline{getInt} method.     

The solution to this issue is simply to change all \androidinline{getInt} calls to \androidinline{getLong} calls on the ``Extra'' \androidinline{Bundle}, and change the saved IDs to \androidinline{long} in the applications. This has to be changed across all applications, but we have implemented it in the launcher and the category tool. 