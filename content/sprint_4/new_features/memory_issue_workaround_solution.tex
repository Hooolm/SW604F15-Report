%!TEX root = ../../../super_main.tex

\section{Memory Issue Workaround Solution}
\label{sec:memory_issue_workaround_solution}

As mentioned in \secref{sec:memory_issues}, there was an issue with bitmaps being kept in memory even when the object displaying the bitmap was deallocated. We developed a workaround for this, which was a temporary solution for the \androidinline{GirafPictogramItemView}. As mentioned in the section, we notified the database groups about this, and proposed a solution.
\\\\
As of the last week of sprint 4, one database group had implemented a solution somewhat similar to the one we proposed. Previously, the database entities that subclassed the \androidinline{BasicImageModel} class had the \androidinline{getImage} and \androidinline{setImage} methods, which would eventually cause a memory leak.
\\\\
This class has now been removed and instead replaced with an \androidinline{ImageEntity} interface which database abstraction classes with an image should now implement. This \androidinline{ImageEntity} is then used with a new \androidinline{BaseImageControllerHelper} database class. This helper has methods that expect an \androidinline{ImageEntity} as input, and it can then, based on the actual type of this input, perform actions on the input's corresponding image, e.g. get the \androidinline{Bitmap} of a \androidinline{Pictogram}.
\\\\
This makes sure that references to bitmaps are not kept by the objects implementing \androidinline{ImageEntity}, and instead a bitmap reference is returned to the calling object which called the \androidinline{getImage} method on the \androidinline{BasicImageHelper}. This allows us to bind the bitmaps to the \androidinline{View} which is supposed to show the bitmap, and not the object which implements the \androidinline{ImageEntity}. This allows us to deallocate bitmaps once they are no longer shown in the GUI independent of the objects implementing \androidinline{ImageEntity}. This deprecates our previous workaround regarding memory leaks, however this solution \todo{write why our solution is better}.